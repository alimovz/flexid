!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("htmlScreenCaptureJs",[],t):"object"==typeof exports?exports.htmlScreenCaptureJs=t():e.htmlScreenCaptureJs=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.OBJECT="object",this.STRING="string",this.URI="uri",this.BASE64="base64"},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutputType=void 0,t.capture=function(e,t,r){return(new a.default).capture(e,t,r)};var n=o(r(0)),a=o(r(2));function o(e){return e&&e.__esModule?e:{default:e}}t.OutputType=new n.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(n=(s=i.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(r(3)),s=l(r(4)),i=l(r(0));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._logger=new o.default,this._isBody=!1,this._classMap={},this._classCount=0,this._pseudoClassesText="",this._pseudoClassCount=0,this._shouldHandleImgDataUrl=!0,this._canvas=null,this._ctx=null,this._doc=null,this._options={}}return a(e,[{key:"_handleOptions",value:function(e){this._options={rulesToAddToDocStyle:e&&e.rulesToAddToDocStyle||[],tagsOfIgnoredDocHeadElements:e&&e.tagsOfIgnoredDocHeadElements||["script","link","style"],tagsOfIgnoredDocBodyElements:e&&e.tagsOfIgnoredDocBodyElements||["script"],classesOfIgnoredDocBodyElements:e&&e.classesOfIgnoredDocBodyElements||[],attrKeyValuePairsOfIgnoredElements:e&&e.attrKeyValuePairsOfIgnoredElements||{},tagsOfSkippedElementsForChildTreeCssHandling:e&&e.tagsOfSkippedElementsForChildTreeCssHandling||["svg"],attrKeyForSavingElementOrigClass:e&&e.attrKeyForSavingElementOrigClass||"_class",attrKeyForSavingElementOrigStyle:e&&e.attrKeyForSavingElementOrigStyle||"_style",prefixForNewGeneratedClasses:e&&e.prefixForNewGeneratedClasses||"c",prefixForNewGeneratedPseudoClasses:e&&e.prefixForNewGeneratedPseudoClasses||"p",imageFormatForDataUrl:e&&e.imageFormatForDataUrl||"image/png",imageQualityForDataUrl:e&&e.imageQualityForDataUrl||.92,logLevel:e&&e.logLevel||"warn"}}},{key:"_getCanvasDataUrl",value:function(e){var t="";try{t=e.toDataURL(this._options.imageFormatForDataUrl,this._options.imageQualityForDataUrl)}catch(e){this._logger.warn("getCanvasDataUrl() - "+e.message)}return t}},{key:"_getImgDataUrl",value:function(e){var t="";try{this._canvas||(this._canvas=this._doc.createElement("canvas"),this._ctx=this._canvas.getContext("2d")),this._canvas.width=e.clientWidth,this._canvas.height=e.clientHeight,this._ctx.drawImage(e,0,0),t=this._getCanvasDataUrl(this._canvas)}catch(e){this._logger.warn("getImgDataUrl() - "+e.message),this._shouldHandleImgDataUrl=!1}return t}},{key:"_getClasses",value:function(e){var t=[],r=e.className instanceof SVGAnimatedString?e.className.baseVal:e.className;r&&r.split(" ").forEach(function(e){e&&t.push(e)});return t}},{key:"_handleElmCss",value:function(t,r){this._getClasses(r).length>0&&(r.setAttribute(this._options.attrKeyForSavingElementOrigClass,e._getClassName(r)),r.removeAttribute("class")),r.getAttribute("style")&&(r.setAttribute(this._options.attrKeyForSavingElementOrigStyle,r.getAttribute("style")),r.removeAttribute("style"));for(var n=getComputedStyle(t),a="",o=0;o<n.length;o++){var s=n.item(o),i=s+":"+n.getPropertyValue(s),l=this._classMap[i];l||(this._classCount++,l=""+this._options.prefixForNewGeneratedClasses+this._classCount,this._classMap[i]=l),a+=l+" "}for(var u=["::before","::after"],c=0;c<u.length;c++){var d=u[c],f=getComputedStyle(t,d);if(!["none","normal"].includes(f.content)){this._pseudoClassCount++;var h=""+this._options.prefixForNewGeneratedPseudoClasses+this._pseudoClassCount;a+=h+" ";for(var g=["."+h+d+"{"],v=0;v<f.length;v++){var p=f.item(v),_=f.getPropertyValue(p);g.push(p+":"+_+";")}g.push("}"),this._pseudoClassesText+=g.join("")}}a&&r.setAttribute("class",a.trim())}},{key:"_appendNewStyle",value:function(e){var t=this._doc.createElement("style"),r=this._options.rulesToAddToDocStyle.join(""),a=!0,o=!1,s=void 0;try{for(var i,l=Object.entries(this._classMap)[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var u=n(i.value,2),c=u[0];r+="."+u[1]+"{"+c+"}"}}catch(e){o=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw s}}this._pseudoClassesText&&(r+=this._pseudoClassesText),t.appendChild(this._doc.createTextNode(r)),e.children[0].appendChild(t)}},{key:"_shouldIgnoreElm",value:function(e){var t=this,r=!1;if((!this._isBody&&this._options.tagsOfIgnoredDocHeadElements.includes(e.tagName.toLowerCase())||this._isBody&&this._options.tagsOfIgnoredDocBodyElements.includes(e.tagName.toLowerCase()))&&(r=!0),!r)for(var a=0;a<e.attributes.length;a++)if(e.attributes[a].specified){var o=!0,s=!1,i=void 0;try{for(var l,u=Object.entries(this._options.attrKeyValuePairsOfIgnoredElements)[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=n(l.value,2),d=c[0],f=c[1];if(d===e.attributes[a].name&&f===e.attributes[a].value){r=!0;break}}}catch(e){s=!0,i=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw i}}}!r&&this._isBody&&this._getClasses(e).forEach(function(e){t._options.classesOfIgnoredDocBodyElements.includes(e)&&(r=!0)});return r}},{key:"_recursiveWalk",value:function(t,r,n){if(this._shouldHandleImgDataUrl&&this._isBody&&"IMG"===t.tagName){var a=this._getImgDataUrl(t);a&&r.setAttribute("src",a)}if(this._isBody&&"CANVAS"===t.tagName){var o=this._getCanvasDataUrl(t);o&&r.setAttribute("src",o),r.outerHTML=r.outerHTML.replace(/<canvas/g,"<img")}if(this._isBody&&e._handleInputs(t,r),n&&(this._handleElmCss(t,r),this._options.tagsOfSkippedElementsForChildTreeCssHandling.includes(t.tagName.toLowerCase())&&(n=!1)),t.children)for(var s=t.children.length-1;s>=0;s--)this._shouldIgnoreElm(t.children[s])?r.removeChild(r.children[s]):this._recursiveWalk(t.children[s],r.children[s],n)}},{key:"_createNewHtml",value:function(){var e=this._doc.documentElement.cloneNode(!1);return this._handleElmCss(this._doc.documentElement,e),e}},{key:"_appendNewHead",value:function(e){var t=this._doc.head.cloneNode(!0);this._isBody=!1,this._recursiveWalk(this._doc.head,t,!1),e.appendChild(t)}},{key:"_appendNewBody",value:function(e){var t=this._doc.body.cloneNode(!0);this._isBody=!0,this._recursiveWalk(this._doc.body,t,!0),e.appendChild(t)}},{key:"_getHtmlObject",value:function(){var e=this._createNewHtml();return this._appendNewHead(e),this._appendNewBody(e),this._appendNewStyle(e),e}},{key:"_prepareOutput",value:function(e,t){var r=null,n=new i.default,a=(t||n.OBJECT).toLowerCase();if(a===n.OBJECT)r=e;else{var o=(e?e.outerHTML:"")||"";o&&(a===n.STRING?r=o:a===n.URI?r=s.default.uriEncode(o):a===n.BASE64&&(r=s.default.base64Encode(o))),r=r||""}return this._logger.isDebug()&&this._logger.debug("output: "+(r.outerHTML?r.outerHTML:r)),r}},{key:"capture",value:function(e,t,r){var n=null,a=(new Date).getTime();try{this._handleOptions(r),this._doc=t||document,this._logger.setLogLevel(this._options.logLevel),this._logger.info("capture() outputType: "+e+" - start");var o=this._getHtmlObject();n=this._prepareOutput(o,e)}catch(e){this._logger.error("capture() - error - "+e.message)}finally{this._logger.info("capture() - end - "+((new Date).getTime()-a)+"ms")}return n}}],[{key:"_getClassName",value:function(e){var t=e.className;return t instanceof SVGAnimatedString?t.baseVal:t}},{key:"_handleInputs",value:function(e,t){var r=e.getAttribute("type"),n=e.tagName;if("INPUT"===n&&"text"===r&&e.value)t.setAttribute("value",e.value);else if("TEXTAREA"===n&&e.value)t.innerText=e.value;else if("INPUT"!==n||"checkbox"!==r&&"radio"!==r)if("SELECT"===n&&e.value&&e.children){t.setAttribute("value",e.value);for(var a=e.children.length-1;a>=0;a--)e.children[a].getAttribute("value")===e.value?t.children[a].setAttribute("selected",""):t.children[a].removeAttribute("selected")}else e.value&&t.setAttribute("value",e.value);else e.checked?t.setAttribute("checked",!0):t.removeAttribute("checked")}}]),e}();t.default=u,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._logLevelNames=["debug","info","warn","error","fatal","off"],this.init()}return n(e,[{key:"init",value:function(){this._logLevel=this._logLevelNames.indexOf("warn")}},{key:"setLogLevel",value:function(e){e&&-1!==this._logLevelNames.indexOf(e.toLowerCase())&&(this._logLevel=this._logLevelNames.indexOf(e.toLowerCase()))}},{key:"_log",value:function(e,t){this._logLevel<=this._logLevelNames.indexOf(t)&&console.log("|html-screen-capture-js|"+t+"| "+e)}},{key:"isDebug",value:function(){return this._logLevel===this._logLevelNames.indexOf("debug")}},{key:"debug",value:function(e){this._log(e,"debug")}},{key:"info",value:function(e){this._log(e,"info")}},{key:"warn",value:function(e){this._log(e,"warn")}},{key:"error",value:function(e){this._log(e,"error")}},{key:"fatal",value:function(e){this._log(e,"fatal")}}]),e}();t.default=a,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"_utf8_encode",value:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}},{key:"base64Encode",value:function(t){var r="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=void 0,o=void 0,s=void 0,i=void 0,l=void 0,u=void 0,c=void 0,d=0;for(t=e._utf8_encode(t);d<t.length;)i=(a=t.charCodeAt(d++))>>2,l=(3&a)<<4|(o=t.charCodeAt(d++))>>4,u=(15&o)<<2|(s=t.charCodeAt(d++))>>6,c=63&s,isNaN(o)?u=c=64:isNaN(s)&&(c=64),r=r+n.charAt(i)+n.charAt(l)+n.charAt(u)+n.charAt(c);return r}},{key:"uriEncode",value:function(e){return(e?encodeURI(e):"")||""}}]),e}();t.default=a,e.exports=t.default}])});
